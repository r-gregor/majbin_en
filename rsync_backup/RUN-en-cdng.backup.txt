#! /usr/bin/env bash

DRPBX_ODPRTO="/c/Users/gregor.redelonghi/majstaf/drpbx-en/ODPRTO"


# VARS
gr_DRYRUNCMD="rsync -rltDv --delete"
gr_FROM1="${HOME}/majstaf/majbin_en/"
gr_TO1="${DRPBX_ODPRTO}/MCDN_en/"
gr_FROM2="/home/gregor.redelonghi/java/"
gr_TO2="${DRPBX_ODPRTO}/home_username_java_en/"


# novo 20201102
gr_FROM3="/home/gregor.redelonghi/majstaf/metsys_en/"
gr_TO3="${DRPBX_ODPRTO}/METSYS_skupno/en/metsys_en/"

# timestamp
function tms() {
    echo -n "[ $(date +%Y%m%d_%H%M%S) ] "
}

crtn=100
function crtc() {
    for ((i=1; i<=$1; i++)); do
        echo -n "-"
    done
    echo
}


# run
function runBackups() {
    tms; crtc $(($crtn-20))
    # tms; echo "syncing ..."
    tms; echo "from: ${gr_FROM1}"
    tms; echo "to:   ${gr_TO1}"
    # rsync -rltDv --delete --progress ${gr_FROM1} ${gr_TO1} | grep -v '^[[:space:]]*$' | while read -r line; do (tms; echo $line); done
    ${gr_DRYRUNCMD} ${gr_FROM1} ${gr_TO1} | grep -v '^[[:space:]]*$' | while read -r line; do echo $line | sed "s/.*/[ $(date +%Y%m%d_%H%M%S) ] rsync: & .../"; done
    tms; crtc $(($crtn-20))
    # tms; echo "syncing ..."
    tms; echo "from: ${gr_FROM2}"
    tms; echo "to:   ${gr_TO2}"
    # rsync -rltDv --delete --progress ${gr_FROM2} ${gr_TO2} | grep -v '^[[:space:]]*$' | while read -r line; do (tms; echo $line); done
    ${gr_DRYRUNCMD} ${gr_FROM2} ${gr_TO2} | grep -v '^[[:space:]]*$' | while read -r line; do echo $line | sed "s/.*/[ $(date +%Y%m%d_%H%M%S) ] rsync: & .../"; done
}

# new 20201102
function runNewBackup1() {
    tms; crtc $(($crtn-20))
    # tms; echo "syncing ..."
    tms; echo "from: ${gr_FROM3}"
    tms; echo "to:   ${gr_TO3}"
    ${gr_DRYRUNCMD} ${gr_FROM3} ${gr_TO3} | grep -v '^[[:space:]]*$' | while read -r line; do echo $line | sed "s/.*/[ $(date +%Y%m%d_%H%M%S) ] rsync: & .../"; done
}

# main
dT1=$(date +"%s")
tms; echo "Starting $0"
tms; echo "Syncing ..."
runBackups
# novo 20201102
runNewBackup1
tms; crtc $(($crtn-20))
dT2=$(date +"%s")
tms; echo "Done in $((dT2-dT1)) seconds!"
crtc $crtn

